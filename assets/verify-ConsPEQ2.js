import{d as j,H as D,p,J as K,K as Z,x as C,y as R,C as G,f as r,o as I,M as E,k as T,i as o,g as B,l as s,v as w,w as g,G as U,n as J}from"./index-HzsorJAI.js";import{a as N}from"./navbar-CoTqHgG1.js";import{c as Y,a as v,T as L,b as P,S as z,f as l,C as Q}from"./text.input-MCk6Ukxd.js";var W=s('<span class="xl:text-xl font-semibold text-center">Kami mohon maaf, link yang kami sediakan tidak valid,<div class=divider></div>mohon kirimkan permintaan link baru untuk memproses permintaan perubahan password anda.'),X=s('<div class="flex items-center justify-between">'),ee=s('<button type=button class="btn btn-block btn-primary">Back'),te=s('<span class="xl:text-xl font-semibold">Please enter your new password below, and we will change your current password with new password.'),ae=s("<span>Submit"),re=s('<span class="loading loading-dots loading-lg">'),ne=s('<div class="w-full flex flex-col items-stretch gap-3"><label class="input input-bordered flex items-center gap-2"><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 16 16"fill=currentColor class="w-4 h-4 opacity-70"><path fill-rule=evenodd d="M14 6a4 4 0 0 1-4.899 3.899l-1.955 1.955a.5.5 0 0 1-.353.146H5v1.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-2.293a.5.5 0 0 1 .146-.353l3.955-3.955A4 4 0 1 1 14 6Zm-4-2a.75.75 0 0 0 0 1.5.5.5 0 0 1 .5.5.75.75 0 0 0 1.5 0 2 2 0 0 0-2-2Z"clip-rule=evenodd></path></svg></label><label class="input input-bordered flex items-center gap-2"><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 16 16"fill=currentColor class="w-4 h-4 opacity-70"><path fill-rule=evenodd d="M14 6a4 4 0 0 1-4.899 3.899l-1.955 1.955a.5.5 0 0 1-.353.146H5v1.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-2.293a.5.5 0 0 1 .146-.353l3.955-3.955A4 4 0 1 1 14 6Zm-4-2a.75.75 0 0 0 0 1.5.5.5 0 0 1 .5.5.75.75 0 0 0 1.5 0 2 2 0 0 0-2-2Z"clip-rule=evenodd></path></svg></label><div class="flex items-center justify-between"></div><button type=submit class="btn btn-block btn-primary"></button><div class="divider text-sm"></div><div class="w-full flex justify-center items-center gap-4"><button type=button class="btn btn-block dark:btn-neutral">Home'),se=s('<span class="xl:text-xl font-semibold">Mohon maaf, seprtinya terjadi kesalahan,<div class=divider></div>silahkan coba beberapa saat lagi atau hubungi admin.');function de(){const i=j(),m=D(),[n,f]=p(!0),[b,A]=p(""),[h,k]=p(!1),[_,M]=p(""),t=Y({safe_form:v(!1),new_password:v("",{required:!0,validators:[l.required,l.minLength,l.maxLength]}),new_password_confirmation:v("",{required:!0,validators:[l.required,l.minLength,l.maxLength]})});K(()=>{const{state:e,query:a}=Z();if(!a||a==null||a==null){i("/",{replace:!0});return}if((a.otp==null||a.email==null)&&!e?.isOk){i("/",{replace:!0});return}if(!e||e==null||e==null&&!e?.isOk){i(`/forgot-password/verify/${m.id}`,{replace:!0,state:{otp:e.otp,email:e.email,isOk:!0}});return}A(e.otp),M(e.email),O()});const O=async()=>{await C.post({url:"public/forgot-password/check",name:"System",data:{email:_(),otp:b(),token:m?.id},server:R.AUTH,success:()=>{k(!0)},error:()=>{k(!1)},finally:()=>{f(!1)}})},q=()=>{if(t.isSubmitted){w("System","Formulir sudah dikirimkan",g.ERROR);return}if(!t.isValid){w("System","Silahkan isi semua formulir",g.ERROR);return}if(Q.validateToken())t.controls.safe_form.setErrors(null);else{t.controls.safe_form.setErrors({invalid:"csrf token tidak valid"});return}if(t.value.new_password!==t.value.new_password_confirmation){t.controls.new_password_confirmation.setErrors({notMatch:"tidak cocok dengan password"});return}t.markSubmitted(!0),f(!0),F()},F=async()=>{await C.patch({url:"public/forgot-password/verify",name:"Register",data:{email:_(),otp:b(),token:m?.id,new_password:t.value.new_password,new_password_confirmation:t.value.new_password_confirmation},server:R.AUTH,success:()=>{i("/forgot-password/done",{replace:!0,state:{isDone:!0}})},error:e=>{console.log(e),w("Forgot Password",e.message,g.ERROR)},finally:()=>{t.markSubmitted(!1),f(!1)}})};return G(e=>{t.isDirty&&!e.defaultPrevented&&!t.controls.safe_form.errors&&(e.preventDefault(),setTimeout(()=>{U.fire({title:"Konfirmasi",icon:"question",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",html:`
            <div class="flex justify-center items-center gap-4 mt-4">
              <span>
                Apakah anda yakin ingin meninggalkan halaman ini?
                <br />
                Semua data yang sudah di isi akan hilang!!
              </span>
            </div>
          `}).then(a=>{a.isConfirmed&&e.retry(!0)})},100))}),r(z,{get regenerate(){return!!t.controls.safe_form.errors},get children(){return r(N,{get disabled(){return n()},title:"Lupa Password",get children(){return r(I,{get fallback(){return se()},get children(){return[r(E,{get when(){return!h()},get children(){return[W(),X(),(()=>{var e=ee();return e.$$click=()=>i("/login",{replace:!0}),T(()=>e.disabled=n()),e})()]}}),r(E,{get when(){return h()},get children(){return[te(),(()=>{var e=ne(),a=e.firstChild;a.firstChild;var c=a.nextSibling;c.firstChild;var x=c.nextSibling,d=x.nextSibling,H=d.nextSibling,V=H.nextSibling,y=V.firstChild;return o(a,r(L,{type:"password",name:"new_password",get disabled(){return n()},placeholder:"Password Baru",get control(){return t.controls.new_password},class:"grow input outline-none focus:outline-none border-none border-[0px] h-auto pl-1 pr-0"}),null),o(e,r(P,{name:"Password Baru",get control(){return t.controls.new_password}}),c),o(c,r(L,{type:"password",name:"new_password_confirmation",get disabled(){return n()},placeholder:"Konfirmasi Password Baru",get control(){return t.controls.new_password_confirmation},class:"grow input outline-none focus:outline-none border-none border-[0px] h-auto pl-1 pr-0"}),null),o(e,r(P,{name:"Konfirmasi Password Baru",get control(){return t.controls.new_password_confirmation}}),x),d.$$click=q,o(d,r(B,{get when(){return!n()},get children(){return ae()}}),null),o(d,r(B,{get when(){return n()},get children(){return re()}}),null),y.$$click=()=>i("/"),T(u=>{var S=n(),$=n();return S!==u.e&&(d.disabled=u.e=S),$!==u.t&&(y.disabled=u.t=$),u},{e:void 0,t:void 0}),e})()]}})]}})}})}})}J(["click"]);export{de as default};
