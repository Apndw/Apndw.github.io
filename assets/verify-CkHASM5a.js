import{d as V,B as D,p,C as K,G as Z,r as C,v as E,y as I,f as r,H as G,I as R,j as B,i as l,g as T,l as s,q as w,E as g,z as U,n as z}from"./index-q5C9yns_.js";import{a as N}from"./navbar-BFZbUuf2.js";import{c as Y,a as v,T as L,b as P,S as J,f as o,C as Q}from"./text.input-B6lIri_G.js";var W=s('<span class="xl:text-xl font-semibold text-center">Kami mohon maaf, link yang kami sediakan tidak valid,<div class=divider></div>mohon kirimkan permintaan link baru untuk memproses permintaan perubahan password anda.'),X=s('<div class="flex items-center justify-between">'),ee=s('<button type=button class="btn btn-block btn-primary">Back'),te=s('<span class="xl:text-xl font-semibold">Please enter your new password below, and we will change your current password with new password.'),ae=s("<span>Submit"),re=s('<span class="loading loading-dots loading-lg">'),ne=s('<div class="w-full flex flex-col items-stretch gap-3"><label class="input input-bordered flex items-center gap-2"><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 16 16"fill=currentColor class="w-4 h-4 opacity-70"><path fill-rule=evenodd d="M14 6a4 4 0 0 1-4.899 3.899l-1.955 1.955a.5.5 0 0 1-.353.146H5v1.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-2.293a.5.5 0 0 1 .146-.353l3.955-3.955A4 4 0 1 1 14 6Zm-4-2a.75.75 0 0 0 0 1.5.5.5 0 0 1 .5.5.75.75 0 0 0 1.5 0 2 2 0 0 0-2-2Z"clip-rule=evenodd></path></svg></label><label class="input input-bordered flex items-center gap-2"><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 16 16"fill=currentColor class="w-4 h-4 opacity-70"><path fill-rule=evenodd d="M14 6a4 4 0 0 1-4.899 3.899l-1.955 1.955a.5.5 0 0 1-.353.146H5v1.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-2.293a.5.5 0 0 1 .146-.353l3.955-3.955A4 4 0 1 1 14 6Zm-4-2a.75.75 0 0 0 0 1.5.5.5 0 0 1 .5.5.75.75 0 0 0 1.5 0 2 2 0 0 0-2-2Z"clip-rule=evenodd></path></svg></label><div class="flex items-center justify-between"></div><button type=submit class="btn btn-block btn-primary"></button><div class="divider text-sm"></div><div class="w-full flex justify-center items-center gap-4"><button type=button class="btn btn-block dark:btn-neutral">Home'),se=s('<span class="xl:text-xl font-semibold">Mohon maaf, seprtinya terjadi kesalahan,<div class=divider></div>silahkan coba beberapa saat lagi atau hubungi admin.');function de(){const i=V(),m=D(),[n,f]=p(!0),[b,A]=p(""),[h,_]=p(!1),[k,q]=p(""),t=Y({safe_form:v(!1),new_password:v("",{required:!0,validators:[o.required,o.minLength,o.maxLength]}),new_password_confirmation:v("",{required:!0,validators:[o.required,o.minLength,o.maxLength]})});K(()=>{const{state:e,query:a}=Z();if(!a||a==null||a==null){i("/",{replace:!0});return}if((a.otp==null||a.email==null)&&!e?.isOk){i("/",{replace:!0});return}if(!e||e==null||e==null&&!e?.isOk){i(`/forgot-password/verify/${m.id}`,{replace:!0,state:{otp:e.otp,email:e.email,isOk:!0}});return}A(e.otp),q(e.email),O()});const O=async()=>{await C.post({url:"public/forgot-password/check",name:"System",data:{email:k(),otp:b(),token:m?.id},server:E.AUTH,success:()=>{_(!0)},error:()=>{_(!1)},finally:()=>{f(!1)}})},j=()=>{if(t.isSubmitted){w("System","Formulir sudah dikirimkan",g.ERROR);return}if(!t.isValid){w("System","Silahkan isi semua formulir",g.ERROR);return}if(Q.validateToken())t.controls.safe_form.setErrors(null);else{t.controls.safe_form.setErrors({invalid:"csrf token tidak valid"});return}if(t.value.new_password!==t.value.new_password_confirmation){t.controls.new_password_confirmation.setErrors({notMatch:"tidak cocok dengan password"});return}t.markSubmitted(!0),f(!0),F()},F=async()=>{await C.patch({url:"public/forgot-password/verify",name:"Register",data:{email:k(),otp:b(),token:m?.id,new_password:t.value.new_password,new_password_confirmation:t.value.new_password_confirmation},server:E.AUTH,success:()=>{i("/forgot-password/done",{replace:!0,state:{isDone:!0}})},error:e=>{console.log(e),w("Forgot Password",e.message,g.ERROR)},finally:()=>{t.markSubmitted(!1),f(!1)}})};return I(e=>{t.isDirty&&!e.defaultPrevented&&!t.controls.safe_form.errors&&(e.preventDefault(),setTimeout(()=>{U.fire({title:"Konfirmasi",icon:"question",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",html:`
            <div class="flex justify-center items-center gap-4 mt-4">
              <span>
                Apakah anda yakin ingin meninggalkan halaman ini?
                <br />
                Semua data yang sudah di isi akan hilang!!
              </span>
            </div>
          `}).then(a=>{a.isConfirmed&&e.retry(!0)})},100))}),r(J,{get regenerate(){return!!t.controls.safe_form.errors},get children(){return r(N,{get disabled(){return n()},title:"Lupa Password",get children(){return r(G,{get fallback(){return se()},get children(){return[r(R,{get when(){return!h()},get children(){return[W(),X(),(()=>{var e=ee();return e.$$click=()=>i("/login",{replace:!0}),B(()=>e.disabled=n()),e})()]}}),r(R,{get when(){return h()},get children(){return[te(),(()=>{var e=ne(),a=e.firstChild;a.firstChild;var c=a.nextSibling;c.firstChild;var x=c.nextSibling,d=x.nextSibling,H=d.nextSibling,M=H.nextSibling,y=M.firstChild;return l(a,r(L,{type:"password",name:"new_password",get disabled(){return n()},placeholder:"Password Baru",get control(){return t.controls.new_password},class:"grow input outline-none focus:outline-none border-none border-[0px] h-auto pl-1 pr-0"}),null),l(e,r(P,{name:"Password Baru",get control(){return t.controls.new_password}}),c),l(c,r(L,{type:"password",name:"new_password_confirmation",get disabled(){return n()},placeholder:"Konfirmasi Password Baru",get control(){return t.controls.new_password_confirmation},class:"grow input outline-none focus:outline-none border-none border-[0px] h-auto pl-1 pr-0"}),null),l(e,r(P,{name:"Konfirmasi Password Baru",get control(){return t.controls.new_password_confirmation}}),x),d.$$click=j,l(d,r(T,{get when(){return!n()},get children(){return ae()}}),null),l(d,r(T,{get when(){return n()},get children(){return re()}}),null),y.$$click=()=>i("/"),B(u=>{var S=n(),$=n();return S!==u.e&&(d.disabled=u.e=S),$!==u.t&&(y.disabled=u.t=$),u},{e:void 0,t:void 0}),e})()]}})]}})}})}})}z(["click"]);export{de as default};
